<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Cross-validation for plmm — cv_plmm • plmmr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Cross-validation for plmm — cv_plmm"><meta name="description" content="Performs k-fold cross validation for lasso-, MCP-, or SCAD-penalized
linear mixed models over a grid of values for the regularization parameter lambda."><meta property="og:description" content="Performs k-fold cross validation for lasso-, MCP-, or SCAD-penalized
linear mixed models over a grid of values for the regularization parameter lambda."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">plmmr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.1.1.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/getting-started.html">Getting started</a></li>
    <li><a class="dropdown-item" href="../articles/process_plink_files.html">If your data is from PLINK...</a></li>
    <li><a class="dropdown-item" href="../articles/notation.html">Notes on notation</a></li>
    <li><a class="dropdown-item" href="../articles/filebacking.html">File-backed data (how to work with big files)</a></li>
    <li><a class="dropdown-item" href="../articles/deconfounding.html">In progress: PLMMs &amp; deconfounding</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/pbreheny/plmmr"><span class="fa fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Cross-validation for plmm</h1>

      <div class="d-none name"><code>cv_plmm.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Performs k-fold cross validation for lasso-, MCP-, or SCAD-penalized
linear mixed models over a grid of values for the regularization parameter <code>lambda</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">cv_plmm</span><span class="op">(</span></span>
<span>  <span class="va">X</span>,</span>
<span>  y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  col_names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  non_genomic <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  K <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  diag_K <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  eta_star <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  penalty <span class="op">=</span> <span class="st">"lasso"</span>,</span>
<span>  penalty_factor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"blup"</span>,</span>
<span>  <span class="va">gamma</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">lambda_min</span>,</span>
<span>  nlambda <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  <span class="va">lambda</span>,</span>
<span>  eps <span class="op">=</span> <span class="fl">1e-04</span>,</span>
<span>  max_iter <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  convex <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  dfmax <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  warn <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  init <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">cluster</span>,</span>
<span>  nfolds <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  <span class="va">seed</span>,</span>
<span>  fold <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  returnY <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  returnBiasDetails <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  trace <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  save_rds <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  save_fold_res <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return_fit <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  compact_save <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">X<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>Design matrix for model fitting. May include clinical covariates and other non-SNP data.</p></dd>


<dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>Continuous outcome vector. Defaults to NULL, assuming that the outcome is the 6th column in the .fam PLINK file data. Can also be a user-supplied numeric vector.</p></dd>


<dt id="arg-col-names">col_names<a class="anchor" aria-label="anchor" href="#arg-col-names"></a></dt>
<dd><p>Optional vector of column names for design matrix. Defaults to NULL.</p></dd>


<dt id="arg-non-genomic">non_genomic<a class="anchor" aria-label="anchor" href="#arg-non-genomic"></a></dt>
<dd><p>Optional vector specifying which columns of the design matrix represent features that are <em>not</em> genomic, as these features are excluded from the empirical estimation of genomic relatedness.
For cases where X is a filepath to an object created by <code><a href="process_plink.html">process_plink()</a></code>, this is handled automatically via the arguments to <code><a href="process_plink.html">process_plink()</a></code>.
For all other cases, 'non_genomic' defaults to NULL (meaning <code><a href="plmm.html">plmm()</a></code> will assume that all columns of <code>X</code> represent genomic features).</p></dd>


<dt id="arg-k">K<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>Similarity matrix used to rotate the data. This should either be (1) a known matrix that reflects the covariance of y, (2) an estimate (Default is \(\frac{1}{p}(XX^T)\)), or (3) a list with components 'd' and 'u', as returned by choose_k().</p></dd>


<dt id="arg-diag-k">diag_K<a class="anchor" aria-label="anchor" href="#arg-diag-k"></a></dt>
<dd><p>Logical: should K be a diagonal matrix? This would reflect observations that are unrelated, or that can be treated as unrelated. Defaults to FALSE.
Note: plmm() does not check to see if a matrix is diagonal. If you want to use a diagonal K matrix, you must set diag_K = TRUE.</p></dd>


<dt id="arg-eta-star">eta_star<a class="anchor" aria-label="anchor" href="#arg-eta-star"></a></dt>
<dd><p>Optional argument to input a specific eta term rather than estimate it from the data. If K is a known covariance matrix that is full rank, this should be 1.</p></dd>


<dt id="arg-penalty">penalty<a class="anchor" aria-label="anchor" href="#arg-penalty"></a></dt>
<dd><p>The penalty to be applied to the model. Either "lasso" (the default), "SCAD", or "MCP".</p></dd>


<dt id="arg-penalty-factor">penalty_factor<a class="anchor" aria-label="anchor" href="#arg-penalty-factor"></a></dt>
<dd><p>A multiplicative factor for the penalty applied to each coefficient.
If supplied, penalty_factor must be a numeric vector of length equal to the number of columns of X.
The purpose of penalty_factor is to apply differential penalization if some coefficients are thought to be more likely than others to be in the model.
In particular, penalty_factor can be 0, in which case the coefficient is always in the model without shrinkage.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>A character argument indicating what should be returned from predict.plmm(). If type == 'lp', predictions are
based on the linear predictor, X beta. If type == 'blup', predictions are based on the sum of the linear predictor
and the estimated random effect (BLUP). Defaults to 'blup', as this has shown to be a superior prediction method
in many applications.</p></dd>


<dt id="arg-gamma">gamma<a class="anchor" aria-label="anchor" href="#arg-gamma"></a></dt>
<dd><p>The tuning parameter of the MCP/SCAD penalty (see details). Default is 3 for MCP and 3.7 for SCAD.</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>Tuning parameter for the Mnet estimator which controls the relative contributions from the MCP/SCAD penalty and the ridge, or L2 penalty. alpha=1 is equivalent to MCP/SCAD penalty, while alpha=0 would be equivalent to ridge regression. However, alpha=0 is not supported; alpha may be arbitrarily small, but not exactly 0.</p></dd>


<dt id="arg-lambda-min">lambda_min<a class="anchor" aria-label="anchor" href="#arg-lambda-min"></a></dt>
<dd><p>The smallest value for lambda, as a fraction of lambda.max. Default is .001 if the number of observations is larger than the number of covariates and .05 otherwise.</p></dd>


<dt id="arg-nlambda">nlambda<a class="anchor" aria-label="anchor" href="#arg-nlambda"></a></dt>
<dd><p>Length of the sequence of lambda. Default is 100.</p></dd>


<dt id="arg-lambda">lambda<a class="anchor" aria-label="anchor" href="#arg-lambda"></a></dt>
<dd><p>A user-specified sequence of lambda values. By default, a sequence of values of length nlambda is computed, equally spaced on the log scale.</p></dd>


<dt id="arg-eps">eps<a class="anchor" aria-label="anchor" href="#arg-eps"></a></dt>
<dd><p>Convergence threshold. The algorithm iterates until the RMSD for the change in linear predictors for each coefficient is less than eps. Default is <code>1e-4</code>.</p></dd>


<dt id="arg-max-iter">max_iter<a class="anchor" aria-label="anchor" href="#arg-max-iter"></a></dt>
<dd><p>Maximum number of iterations (total across entire path). Default is 10000.</p></dd>


<dt id="arg-convex">convex<a class="anchor" aria-label="anchor" href="#arg-convex"></a></dt>
<dd><p>(future idea; not yet incorporated) Calculate index for which objective function ceases to be locally convex? Default is TRUE.</p></dd>


<dt id="arg-dfmax">dfmax<a class="anchor" aria-label="anchor" href="#arg-dfmax"></a></dt>
<dd><p>(future idea; not yet incorporated) Upper bound for the number of nonzero coefficients. Default is no upper bound. However, for large data sets, computational burden may be heavy for models with a large number of nonzero coefficients.</p></dd>


<dt id="arg-warn">warn<a class="anchor" aria-label="anchor" href="#arg-warn"></a></dt>
<dd><p>Return warning messages for failures to converge and model saturation? Default is TRUE.</p></dd>


<dt id="arg-init">init<a class="anchor" aria-label="anchor" href="#arg-init"></a></dt>
<dd><p>Initial values for coefficients. Default is 0 for all columns of X.</p></dd>


<dt id="arg-cluster">cluster<a class="anchor" aria-label="anchor" href="#arg-cluster"></a></dt>
<dd><p>cv_plmm() can be run in parallel across a cluster using the parallel package. The cluster must be set up in
advance using parallel::makeCluster(). The cluster must then be passed to cv_plmm().</p></dd>


<dt id="arg-nfolds">nfolds<a class="anchor" aria-label="anchor" href="#arg-nfolds"></a></dt>
<dd><p>The number of cross-validation folds. Default is 5.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>You may set the seed of the random number generator in order to obtain reproducible results.</p></dd>


<dt id="arg-fold">fold<a class="anchor" aria-label="anchor" href="#arg-fold"></a></dt>
<dd><p>Which fold each observation belongs to. By default, the observations are randomly assigned.</p></dd>


<dt id="arg-returny">returnY<a class="anchor" aria-label="anchor" href="#arg-returny"></a></dt>
<dd><p>Should cv_plmm() return the linear predictors from the cross-validation folds? Default is FALSE; if TRUE,
this will return a matrix in which the element for row i, column j is the fitted value for observation i from
the fold in which observation i was excluded from the fit, at the jth value of lambda.</p></dd>


<dt id="arg-returnbiasdetails">returnBiasDetails<a class="anchor" aria-label="anchor" href="#arg-returnbiasdetails"></a></dt>
<dd><p>Logical: should the cross-validation bias (numeric value) and loss (n x p matrix) be returned? Defaults to FALSE.</p></dd>


<dt id="arg-trace">trace<a class="anchor" aria-label="anchor" href="#arg-trace"></a></dt>
<dd><p>If set to TRUE, inform the user of progress by announcing the beginning of each CV fold. Default is FALSE.</p></dd>


<dt id="arg-save-rds">save_rds<a class="anchor" aria-label="anchor" href="#arg-save-rds"></a></dt>
<dd><p>Optional: if a filepath and name <em>without</em> the '.rds' suffix is specified (e.g., <code>save_rds = "~/dir/my_results"</code>), then the model results are saved to the provided location (e.g., "~/dir/my_results.rds").
Defaults to NULL, which does not save the result.</p></dd>


<dt id="arg-save-fold-res">save_fold_res<a class="anchor" aria-label="anchor" href="#arg-save-fold-res"></a></dt>
<dd><p>Optional: a logical value indicating whether the results (loss and predicted values) from each CV fold should be saved?
If TRUE, then two '.rds' files will be saved ('loss' and 'yhat') will be created in the same directory as 'save_rds'.
Both files will be updated after each fold is done.
Defaults to FALSE.</p></dd>


<dt id="arg-return-fit">return_fit<a class="anchor" aria-label="anchor" href="#arg-return-fit"></a></dt>
<dd><p>Optional: a logical value indicating whether the fitted model should be returned as a <code>plmm</code> object in the current (assumed interactive) session. Defaults to TRUE.</p></dd>


<dt id="arg-compact-save">compact_save<a class="anchor" aria-label="anchor" href="#arg-compact-save"></a></dt>
<dd><p>Optional: if TRUE, three separate .rds files will saved: one with the 'beta_vals', one with 'K', and one with everything else (see below).
Defaults to FALSE. <strong>Note</strong>: you must specify <code>save_rds</code> for this argument to be called.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments to <code>plmm_fit</code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a list with 11 items:</p><ul><li><p>type: the type of prediction used ('lp' or 'blup')</p></li>
<li><p>cve: numeric vector with the cross validation error (CVE) at each value of <code>lambda</code></p></li>
<li><p>cvse: numeric vector with the estimated standard error associated with each value of for <code>cve</code></p></li>
<li><p>fold: numeric <code>n</code> length vector of integers indicating the fold to which each observation was assigned</p></li>
<li><p>lambda: numeric vector of <code>lambda</code> values</p></li>
<li><p>fit: the overall fit of the object, including all predictors; this is a
list as returned by <code><a href="plmm.html">plmm()</a></code></p></li>
<li><p>min: The index corresponding to the value of <code>lambda</code> that minimizes <code>cve</code></p></li>
<li><p>lambda_min: The <code>lambda</code> value at which <code>cve</code> is minmized</p></li>
<li><p>min1se: The index corresponding to the value of <code>lambda</code> within
standard error of that which minimizes <code>cve</code></p></li>
<li><p>lambda1se: largest value of lambda such that error is within 1 standard error of the minimum.</p></li>
<li><p>null.dev: numeric value representing the deviance for the
intercept-only model. If you have supplied your own <code>lambda</code> sequence,
this quantity may not be meaningful.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">cv_fit</span> <span class="op">&lt;-</span> <span class="fu">cv_plmm</span><span class="op">(</span>X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">admix</span><span class="op">$</span><span class="va">race</span>,<span class="va">admix</span><span class="op">$</span><span class="va">X</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">admix</span><span class="op">$</span><span class="va">y</span>,</span></span>
<span class="r-in"><span> non_genomic <span class="op">=</span> <span class="fl">1</span>, penalty_factor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">admix</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cv_fit</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lasso-penalized model with n=197 and p=102</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> At minimum cross-validation error (lambda=0.1898):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Nonzero coefficients: 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Cross-validation error (deviance): 1.17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Scale estimate (sigma): 1.083</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cv_fit</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="cv_plmm-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Note: for examples with filebacked data, see the filebacking vignette</span></span></span>
<span class="r-in"><span><span class="co"># https://pbreheny.github.io/plmmr/articles/filebacking.html</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tabitha K. Peter, Anna C. Reisetter, Patrick J. Breheny, Yujing Lu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

