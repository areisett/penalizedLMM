<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Preprocess PLINK files using the bigsnpr package — process_plink • plmmr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Preprocess PLINK files using the bigsnpr package — process_plink"><meta name="description" content="Preprocess PLINK files using the bigsnpr package"><meta property="og:description" content="Preprocess PLINK files using the bigsnpr package"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">plmmr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.1.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/getting-started.html">Getting started</a></li>
    <li><a class="dropdown-item" href="../articles/process_plink_files.html">If your data is from PLINK...</a></li>
    <li><a class="dropdown-item" href="../articles/notation.html">Notes on notation</a></li>
    <li><a class="dropdown-item" href="../articles/filebacking.html">File-backed data (how to work with big files)</a></li>
    <li><a class="dropdown-item" href="../articles/deconfounding.html">In progress: PLMMs &amp; deconfounding</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/pbreheny/plmmr"><span class="fa fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Preprocess PLINK files using the <code>bigsnpr</code> package</h1>

      <div class="d-none name"><code>process_plink.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Preprocess PLINK files using the <code>bigsnpr</code> package</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">process_plink</span><span class="op">(</span></span>
<span>  <span class="va">data_dir</span>,</span>
<span>  <span class="va">prefix</span>,</span>
<span>  rds_dir <span class="op">=</span> <span class="va">data_dir</span>,</span>
<span>  <span class="va">bk_filename</span>,</span>
<span>  impute <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  impute_method <span class="op">=</span> <span class="st">"mode"</span>,</span>
<span>  na_phenotype_vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">9</span><span class="op">)</span>,</span>
<span>  id_var <span class="op">=</span> <span class="st">"IID"</span>,</span>
<span>  handle_missing_phen <span class="op">=</span> <span class="st">"prune"</span>,</span>
<span>  add_phen <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pheno_id <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pheno_name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">outfile</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  add_predictor_fam <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  add_predictor_ext <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data-dir">data_dir<a class="anchor" aria-label="anchor" href="#arg-data-dir"></a></dt>
<dd><p>The path to the bed/bim/fam data files, <em>without</em> a trailing "/" (e.g., use <code>data_dir = '~/my_dir'</code>, <strong>not</strong> <code>data_dir = '~/my_dir/'</code>)</p></dd>


<dt id="arg-prefix">prefix<a class="anchor" aria-label="anchor" href="#arg-prefix"></a></dt>
<dd><p>The prefix (as a character string) of the bed/fam data files (e.g., <code>prefix = 'mydata'</code>)</p></dd>


<dt id="arg-rds-dir">rds_dir<a class="anchor" aria-label="anchor" href="#arg-rds-dir"></a></dt>
<dd><p>The path to the directory in which you want to create the new '.rds' and '.bk' files. Defaults to <code>data_dir</code></p></dd>


<dt id="arg-bk-filename">bk_filename<a class="anchor" aria-label="anchor" href="#arg-bk-filename"></a></dt>
<dd><p>Optional string to name the backingfile that will be created for the output data. Defaults to <code>paste0(std_</code>. <code>prefix</code>).
<strong>Note</strong>: Do NOT include a <code>.bk</code> extension in the filename.</p></dd>


<dt id="arg-impute">impute<a class="anchor" aria-label="anchor" href="#arg-impute"></a></dt>
<dd><p>Logical: should data be imputed? Default to TRUE.</p></dd>


<dt id="arg-impute-method">impute_method<a class="anchor" aria-label="anchor" href="#arg-impute-method"></a></dt>
<dd><p>If 'impute' = TRUE, this argument will specify the kind of imputation desired. Options are:
* mode (default): Imputes the most frequent call. See <code><a href="https://privefl.github.io/bigsnpr/reference/snp_fastImputeSimple.html" class="external-link">bigsnpr::snp_fastImputeSimple()</a></code> for details.
* random: Imputes sampling according to allele frequencies.
* mean0: Imputes the rounded mean.
* mean2: Imputes the mean rounded to 2 decimal places.
* xgboost: Imputes using an algorithm based on local XGBoost models. See <code><a href="https://privefl.github.io/bigsnpr/reference/snp_fastImpute.html" class="external-link">bigsnpr::snp_fastImpute()</a></code> for details. Note: this can take several minutes, even for a relatively small data set.</p></dd>


<dt id="arg-na-phenotype-vals">na_phenotype_vals<a class="anchor" aria-label="anchor" href="#arg-na-phenotype-vals"></a></dt>
<dd><p>A vector of numeric values used to code NA values in the phenotype/outcome (this is the 'affection' column in a <code>bigSNP</code> object, or the last column of a <code>.fam</code> file). Defaults to -9 (matching PLINK conventions).</p></dd>


<dt id="arg-id-var">id_var<a class="anchor" aria-label="anchor" href="#arg-id-var"></a></dt>
<dd><p>String specifying which column of the PLINK <code>.fam</code> file has the unique sample identifiers. Options are "IID" (default) and "FID".</p></dd>


<dt id="arg-handle-missing-phen">handle_missing_phen<a class="anchor" aria-label="anchor" href="#arg-handle-missing-phen"></a></dt>
<dd><p>A string indicating how missing phenotypes should be handled:
* "prune" (default): observations with missing phenotype are removed
* "median": impute missing phenotypes using the median (warning: this is overly simplistic in many cases).
* "mean": impute missing phenotypes using the mean (warning: this is overly simplistic in many cases).
Note: for data coming from PLINK, no missing values of the phenotype are allowed. You have to (1) supply phenotype from an external file,
(2) prune missing values, or (3) impute missing values.</p></dd>


<dt id="arg-add-phen">add_phen<a class="anchor" aria-label="anchor" href="#arg-add-phen"></a></dt>
<dd><p>Optional: A <strong>data frame</strong> with at least two columns: and ID column and a phenotype column</p></dd>


<dt id="arg-pheno-id">pheno_id<a class="anchor" aria-label="anchor" href="#arg-pheno-id"></a></dt>
<dd><p>Optional: A string specifying the name of the ID column in <code>pheno</code>. MUST be specified if <code>add_phen</code> is specified.</p></dd>


<dt id="arg-pheno-name">pheno_name<a class="anchor" aria-label="anchor" href="#arg-pheno-name"></a></dt>
<dd><p>Optional: A string specifying the name of the phenotype column in <code>pheno</code>.  MUST be specified if <code>add_phen</code> is specified. This column will be used as the default <code>y</code> argument to 'plmm()'.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>Logical: should messages to be printed to the console be silenced? Defaults to FALSE</p></dd>


<dt id="arg-outfile">outfile<a class="anchor" aria-label="anchor" href="#arg-outfile"></a></dt>
<dd><p>Optional: the name (character string) of the prefix of the logfile to be written. Defaults to 'process_plink', i.e. you will get 'process_plink.log' as the outfile, created in the same directory as 'data_dir'.</p></dd>


<dt id="arg-overwrite">overwrite<a class="anchor" aria-label="anchor" href="#arg-overwrite"></a></dt>
<dd><p>Logical: if existing <code>.bk</code>/<code>.rds</code> files exist for the specified directory/prefix, should these be overwritten? Defaults to FALSE. Set to TRUE if you want to change the imputation method you're using, etc.
<strong>Note</strong>: If there are multiple <code>.rds</code> files with names that start with "std_prefix_...", <strong>this will error out</strong>.
To protect users from accidentally deleting files with saved results, only one <code>.rds</code> file can be removed with this option.</p></dd>


<dt id="arg-add-predictor-fam">add_predictor_fam<a class="anchor" aria-label="anchor" href="#arg-add-predictor-fam"></a></dt>
<dd><p>Optional: if you want to include "sex" (the 5th column of <code>.fam</code> file) in the analysis, specify 'sex' here.</p></dd>


<dt id="arg-add-predictor-ext">add_predictor_ext<a class="anchor" aria-label="anchor" href="#arg-add-predictor-ext"></a></dt>
<dd><p>Optional: add additional covariates/predictors/features from an external file (i.e., not a PLINK file).
This argument takes one of two kinds of arguments:
- a <strong>named</strong> numeric vector, where the names align with the sample IDs in the PLINK files. <strong>No NA values</strong> can be in this vector.
The names will be used to subset and align this external covariate with the supplied PLINK data. <strong>No NA values</strong> can be in this matrix.
- a numeric matrix whose row names align with the sample IDs in the PLINK files.
The names will be used to subset and align this external covariate with the supplied PLINK data.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Optional: additional arguments to <code><a href="https://privefl.github.io/bigsnpr/reference/snp_fastImpute.html" class="external-link">bigsnpr::snp_fastImpute()</a></code> (relevant only if impute_method = "xgboost")</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Nothing is returned by this function, but (at least) two files are created in
the location specified by <code>rds_dir</code>:</p><ul><li><p>'std_prefix.rds': This is the <code><a href="https://privefl.github.io/bigsnpr/reference/bigSNP-class.html" class="external-link">bigsnpr::bigSNP</a></code> object
that holds the PLINK data along with meta-data. See details for explanation of what
is included in this meta-data</p></li>
<li><p>'std_prefix.bk': Created by the call to <code><a href="standardize_fbm.html">standardize_fbm()</a></code>, this is the
backingfile that stores the numeric data of the standardized design matrix <code>std_X</code></p></li>
</ul><p>Note that <code>process_plink()</code> need only be run once for a given set of PLINK
files; in subsequent data analysis/scripts, <code><a href="get_data.html">get_data()</a></code> will access the '.rds' file.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The '.rds' object created by this function has the following elements:</p><ul><li><p>std_X: The file-backed design matrix, as an <code>FBM</code> object (see <code>bigstatsr</code> package for more info)</p></li>
<li><p>fam: Data frame equivalent of PLINK '.bim' file</p></li>
<li><p>map: Data frame equivalent of PLINK '.fam' file</p></li>
<li><p>colnames: Character vector of column names for the original data (includes constant features, i.e. monomorphic SNPs)</p></li>
<li><p>rownames: Character vector of row names for the original data.</p></li>
<li><p>n: Number of rows (samples) in the original data</p></li>
<li><p>p: Number of columns (features, SNPs, markers, ...) in the original data</p></li>
<li><p>ns: Numeric vector of indices marking the non-singular columns of the original data</p></li>
<li><p>std_X_center: Numeric vector of values used to center the non-singular columns of the data</p></li>
<li><p>std_X_scale: Numeric vector of values used to scale the non-singular columns of the data</p></li>
<li><p>std_X_colnames: Character vector of column names for the standardized data</p></li>
<li><p>std_X_rownames: Character vector of row names for the standardized data.</p></li>
<li><p>complete_phen: Numeric vector of indices marking the samples with a non-missing phenotype. Ony applicable if <code>handle_missing_phen = 'prune'</code></p></li>
<li><p>id_var: String specifying which ID column in the '.fam' file had the unique sample ID: 'FID' (1st column) or 'IID' (2nd column)</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">temp_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># using a temporary directory here</span></span></span>
<span class="r-in"><span><span class="fu">process_plink</span><span class="op">(</span>data_dir <span class="op">=</span> <span class="fu"><a href="find_example_data.html">find_example_data</a></span><span class="op">(</span>parent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="co"># reads data that ships with plmmr</span></span></span>
<span class="r-in"><span>              rds_dir <span class="op">=</span> <span class="va">temp_dir</span>,</span></span>
<span class="r-in"><span>              prefix <span class="op">=</span> <span class="st">"penncath_lite"</span>,</span></span>
<span class="r-in"><span>              outfile <span class="op">=</span> <span class="st">"process_penncath"</span>,</span></span>
<span class="r-in"><span>              overwrite <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>              impute_method <span class="op">=</span> <span class="st">"mode"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Logging to process_penncath.log</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Preprocessing penncath_lite data:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> It looks like your files are zipped -- please unzip them before calling process_plink().</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Creating penncath_lite.rds</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> File '/home/runner/work/_temp/Library/plmmr/extdata/penncath_lite.bed' doesn't exist.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co"># pen &lt;- get_data(file.path(temp_dir, "std_penncath_lite"))</span></span></span>
<span class="r-in"><span> <span class="co"># str(pen)</span></span></span>
<span class="r-in"><span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tabitha K. Peter, Anna C. Reisetter, Patrick J. Breheny, Yujing Lu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

